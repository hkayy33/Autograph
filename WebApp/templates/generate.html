{% extends "base.html" %}

{% block title %}Generate Autograph{% endblock %}

{% block content %}
<div class="generate-container">
    <h1>Generate Autograph</h1>
    <form id="autographForm" action="{{ url_for('generate_autograph') }}" method="POST">
        <div class="form-group">
            <label for="instagram_url">Paste Instagram URL:</label>
            <input type="text" class="form-control" id="instagramUrl" name="instagram_url" required 
                   placeholder="https://www.instagram.com/p/... or https://www.instagram.com/reel/...">
            <small class="form-text text-muted">Supports both Instagram posts and reels. Make sure the content is public.</small>
        </div>
        <button type="submit" class="btn btn-primary">Generate Autographed Caption</button>
    </form>
    <div class="info-box">
        <p>The "Autographed" caption contains a secret invisible code at the end of the caption, which is used as an authentication identifier.</p>
    </div>
    <div class="result-box" style="display: none;">
        <h3>Generated Autograph</h3>
        <div class="autograph-code">
            <code id="autographed-caption"></code>
        </div>
        <div class="caption-info">
            <p><strong>Original Caption:</strong> <span id="original-caption"></span></p>
            <p><strong>Autograph Code:</strong> <span id="autograph-code"></span></p>
        </div>
        <button class="btn btn-secondary" onclick="copyToClipboard()">Copy to Clipboard</button>
        <div class="alert alert-success mt-3" style="display: none;" id="copySuccess">
            Autograph code copied to clipboard!
        </div>
    </div>
</div>

<script>
document.getElementById('autographForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    
    fetch('/api/generate', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            document.querySelector('.result-box').style.display = 'block';
            document.getElementById('autographed-caption').textContent = data.combined_text;
            document.getElementById('original-caption').textContent = data.original_caption;
            document.getElementById('autograph-code').textContent = data.autograph;
        } else {
            alert('Error: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while generating the autograph.');
    });
});

function copyToClipboard() {
    const codeElement = document.getElementById('autographed-caption');
    const textArea = document.createElement('textarea');
    textArea.value = codeElement.textContent;
    document.body.appendChild(textArea);
    textArea.select();
    document.execCommand('copy');
    document.body.removeChild(textArea);
    
    const successAlert = document.getElementById('copySuccess');
    successAlert.style.display = 'block';
    setTimeout(() => {
        successAlert.style.display = 'none';
    }, 3000);
}
</script>
{% endblock %}
